
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://www.ovn.org/ovn-kubernetes/features/cluster-egress-controls/egress-ip/">
      
      
        <link rel="prev" href="../../../ci/ci/">
      
      
        <link rel="next" href="../egress-service/">
      
      
      <link rel="icon" href="../../../images/ovn-inside-k8s.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.10">
    
    
      
        <title>EgressIP - OVN Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#egressip" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OVN Kubernetes" class="md-header__button md-logo" aria-label="OVN Kubernetes" data-md-component="logo">
      
  <img src="../../../images/ovn-inside-k8s.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OVN Kubernetes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              EgressIP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ovn-org/ovn-kubernetes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ovn-org/ovn-kubernetes
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../design/architecture/" class="md-tabs__link">
          
  
    
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting-started/overview.md" class="md-tabs__link">
          
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../governance/CONTRIBUTING/" class="md-tabs__link">
          
  
    
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  Features

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../troubleshooting/debugging/" class="md-tabs__link">
          
  
    
  
  Troubleshooting

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../observability/metrics/" class="md-tabs__link">
          
  
    
  
  Observability

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OVN Kubernetes" class="md-nav__button md-logo" aria-label="OVN Kubernetes" data-md-component="logo">
      
  <img src="../../../images/ovn-inside-k8s.png" alt="logo">

    </a>
    OVN Kubernetes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ovn-org/ovn-kubernetes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ovn-org/ovn-kubernetes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Overview
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/topology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Topology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/gateway-modes.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gateway Modes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/traffic-flows.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traffic Flows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/pod-creation-workflow.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pod Creation Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/service-creation-workflow.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Creation Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/service-traffic-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Traffic Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/host-to-node-port-hairpin-trafficflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Host To NodePort Hairpin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/external-ip-and-loadbalancer-ingress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ExternalIPs/LoadBalancerIngress
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/ovn-kubernetes-subnets.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal Subnets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/live-migration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubevirt VM Live Migration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/overview.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVN Kubernetes Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/launching-ovn-kubernetes.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launching OVN Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/example-pod-creation.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying Workloads on OVN Kubernetes cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/example-service creation.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying Services on OVN Kubernetes cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/building-ovn-kubernetes.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup and Building
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/running-release.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run OVN Kubernetes From Release Image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/running-rpm.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run OVN Kubernetes From RPM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/cli-guide.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/configuration.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Guide
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../governance/CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../governance/REVIEWING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reviewing Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/developer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/api-spec.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes CRD API-Reference Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/image-build.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVN Kubernetes Container Images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/documentation.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/testing.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local Testing Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ci/ci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI Testing Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/debugging.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/release.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Releasing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ClusterEgressControls
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            ClusterEgressControls
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    EgressIP
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    EgressIP
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traffic-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Traffic flows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Traffic flows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod-to-node-ip-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      Pod to node IP traffic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dealing-with-non-snated-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with non SNATed traffic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-considerations-for-egress-ips-hosted-by-standard-linux-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      Special considerations for Egress IPs hosted by standard linux interfaces
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#egress-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Egress Nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#egress-ip-reachability" class="md-nav__link">
    <span class="md-ellipsis">
      Egress IP reachability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Egress IP reachability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#egressiptotaltimeout" class="md-nav__link">
    <span class="md-ellipsis">
      egressIPTotalTimeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grpc-vs-discard-port" class="md-nav__link">
    <span class="md-ellipsis">
      gRPC vs. DISCARD port
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gRPC vs. DISCARD port">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#additional-details-on-the-implementation-of-the-grpc-probing" class="md-nav__link">
    <span class="md-ellipsis">
      Additional details on the implementation of the gRPC probing:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../egress-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EgressService
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../egress-qos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EgressQoS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../egress-gateway.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EgressGateway
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NetworkSecurityControls
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            NetworkSecurityControls
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network-security-controls/network-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkPolicy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network-security-controls/admin-network-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AdminNetworkPolicy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network-security-controls/egress-firewall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EgressFirewall
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    InfrastructureSecurityControls
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            InfrastructureSecurityControls
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure-security-controls/node-identity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NodeIdentity
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    MultiNetworking
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            MultiNetworking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multi-homing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multihoming
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multicast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multicast
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../live-migration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LiveMigration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hybrid-overlay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HybridOverlay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hardware Offload
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Hardware Offload
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware-offload/ovs_offload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS Offload
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware-offload/dpu-acceleration.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Support DPU Acceleration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/ovnkube-trace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVNKube Trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/logging.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Observability
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Observability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../observability/metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metrics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archive
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traffic-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Traffic flows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Traffic flows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod-to-node-ip-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      Pod to node IP traffic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dealing-with-non-snated-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with non SNATed traffic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-considerations-for-egress-ips-hosted-by-standard-linux-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      Special considerations for Egress IPs hosted by standard linux interfaces
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#egress-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Egress Nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#egress-ip-reachability" class="md-nav__link">
    <span class="md-ellipsis">
      Egress IP reachability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Egress IP reachability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#egressiptotaltimeout" class="md-nav__link">
    <span class="md-ellipsis">
      egressIPTotalTimeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grpc-vs-discard-port" class="md-nav__link">
    <span class="md-ellipsis">
      gRPC vs. DISCARD port
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gRPC vs. DISCARD port">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#additional-details-on-the-implementation-of-the-grpc-probing" class="md-nav__link">
    <span class="md-ellipsis">
      Additional details on the implementation of the gRPC probing:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="egressip">EgressIP<a class="headerlink" href="#egressip" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>The Egress IP feature enables a cluster administrator to ensure that the traffic from one or more pods
in one or more namespaces has a consistent source IP address for services outside the cluster network.<br />
East-West traffic (including pod -&gt; node IP) is excluded from Egress IP.  </p>
<p>For more info, consider looking at the following links:
- <a href="https://github.com/ovn-org/ovn-kubernetes/blob/82f167a3920c8c3cd0687ceb3e7a5ba64372be69/go-controller/pkg/crd/egressip/v1/types.go#L47">Egress IP CRD</a>
- <a href="https://docs.okd.io/latest/networking/ovn_kubernetes_network_provider/assigning-egress-ips-ovn.html">Assigning an egress IP address</a>
- <a href="https://rcarrata.com/openshift/egress-ip-ovn/">Managing Egress IP in OpenShift 4 with OVN Kubernetes</a></p>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h2>
<p>An example of EgressIP might look like this:</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.ovn.org/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EgressIP</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">egressip-prod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">egressIPs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.18.0.33</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.18.0.44</span>
<span class="w">  </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environment</span>
<span class="w">        </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NotIn</span>
<span class="w">        </span><span class="nt">values</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</code></pre></div>
It specifies to use <code>172.18.0.33</code> or <code>172.18.0.44</code> egressIP for pods that are labeled with <code>app: web</code> that run in a namespace without <code>environment: development</code> label.
Both selectors use the <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors">generic kubernetes label selectors</a>.</p>
<h2 id="traffic-flows">Traffic flows<a class="headerlink" href="#traffic-flows" title="Permanent link">&para;</a></h2>
<p>If the Egress IP(s) are hosted on the OVN primary network then the implementation is redirecting the POD traffic
to an egress node where it is SNATed and sent out.  </p>
<p>Using the example EgressIP and a matching pod with <code>10.244.1.3</code> IP, the following logical router policies are configured in <code>ovn_cluster_router</code>:
<div class="highlight"><pre><span></span><code>Routing<span class="w"> </span>Policies
<span class="w">  </span><span class="m">1004</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtos-ovn-control-plane&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.4<span class="w"> </span>/*<span class="w"> </span>ovn-control-plane<span class="w"> </span>*/<span class="w">                            </span>reroute<span class="w">  </span><span class="m">10</span>.244.0.2
<span class="w">  </span><span class="m">1004</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtos-ovn-worker&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.2<span class="w"> </span>/*<span class="w"> </span>ovn-worker<span class="w"> </span>*/<span class="w">                                          </span>reroute<span class="w">  </span><span class="m">10</span>.244.1.2
<span class="w">  </span><span class="m">1004</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtos-ovn-worker2&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.3<span class="w"> </span>/*<span class="w"> </span>ovn-worker2<span class="w"> </span>*/<span class="w">                                        </span>reroute<span class="w">  </span><span class="m">10</span>.244.2.2

<span class="w">   </span><span class="m">102</span><span class="w"> </span><span class="o">(</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a12749576804119081385</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a16335301576733828072</span><span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a11079093880111560446</span><span class="w">  </span>allow<span class="w">    </span><span class="nv">pkt_mark</span><span class="o">=</span><span class="m">1008</span>
<span class="w">   </span><span class="m">102</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16<span class="w">                                                           </span>allow
<span class="w">   </span><span class="m">102</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">100</span>.64.0.0/16<span class="w">                                                           </span>allow

<span class="w">   </span><span class="m">100</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.1.3<span class="w">                                                                                          </span>reroute<span class="w">  </span><span class="m">100</span>.64.0.3,<span class="w"> </span><span class="m">100</span>.64.0.4
</code></pre></div>
- Rules with <code>1004</code> priority are responsible for redirecting <code>pod -&gt; local host IP</code> traffic.<br />
- Rules with <code>102</code> priority are added by OVN-Kubernetes when EgressIP feature is enabled, they ensure that east-west traffic is not using egress IPs.
- The rule with <code>100</code> priority is added for the pod matching <code>egressip-prod</code> EgressIP, and it redirects the traffic to one of the egress nodes (ECMP is used to balance the traffic between next hops).</p>
<p>Once the redirected traffic reaches one of the egress nodes it gets SNATed in the gateway router:
<div class="highlight"><pre><span></span><code>ovn-nbctl<span class="w"> </span>lr-nat-list<span class="w"> </span>GR_ovn-worker
TYPE<span class="w">             </span>GATEWAY_PORT<span class="w">          </span>EXTERNAL_IP<span class="w">        </span>EXTERNAL_PORT<span class="w">    </span>LOGICAL_IP<span class="w">          </span>EXTERNAL_MAC<span class="w">         </span>LOGICAL_PORT
...
snat<span class="w">                                   </span><span class="m">172</span>.18.0.33<span class="w">                         </span><span class="m">10</span>.244.1.3
ovn-nbctl<span class="w"> </span>lr-nat-list<span class="w">  </span>GR_ovn-worker2
TYPE<span class="w">             </span>GATEWAY_PORT<span class="w">          </span>EXTERNAL_IP<span class="w">        </span>EXTERNAL_PORT<span class="w">    </span>LOGICAL_IP<span class="w">          </span>EXTERNAL_MAC<span class="w">         </span>LOGICAL_PORT
...
snat<span class="w">                                   </span><span class="m">172</span>.18.0.44<span class="w">                         </span><span class="m">10</span>.244.1.3
</code></pre></div></p>
<p>Lets now imagine the Egress IP(s) mentioned previously, are not hosted by the OVN primary network and is hosted
by a secondary host network which is assigned to a standard linux interface, a redirect to the egress-able node management port IP address:
<div class="highlight"><pre><span></span><code>Routing<span class="w"> </span>Policies
<span class="w">  </span><span class="m">1004</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtos-ovn-control-plane&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.4<span class="w"> </span>/*<span class="w"> </span>ovn-control-plane<span class="w"> </span>*/<span class="w">                            </span>reroute<span class="w">  </span><span class="m">10</span>.244.0.2
<span class="w">  </span><span class="m">1004</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtos-ovn-worker&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.2<span class="w"> </span>/*<span class="w"> </span>ovn-worker<span class="w"> </span>*/<span class="w">                                          </span>reroute<span class="w">  </span><span class="m">10</span>.244.1.2
<span class="w">  </span><span class="m">1004</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtos-ovn-worker2&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.3<span class="w"> </span>/*<span class="w"> </span>ovn-worker2<span class="w"> </span>*/<span class="w">                                        </span>reroute<span class="w">  </span><span class="m">10</span>.244.2.2

<span class="w">   </span><span class="m">102</span><span class="w"> </span><span class="o">(</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a12749576804119081385</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a16335301576733828072</span><span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a11079093880111560446</span><span class="w">  </span>allow<span class="w">    </span><span class="nv">pkt_mark</span><span class="o">=</span><span class="m">1008</span>
<span class="w">   </span><span class="m">102</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16<span class="w">                                                           </span>allow
<span class="w">   </span><span class="m">102</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">100</span>.64.0.0/16<span class="w">                                                           </span>allow

<span class="w">   </span><span class="m">100</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.1.3<span class="w">                                                                                          </span>reroute<span class="w">  </span><span class="m">10</span>.244.1.2,<span class="w"> </span><span class="m">10</span>.244.2.2
</code></pre></div></p>
<p>IPTables will have the following chain in NAT table and also rules within that chain to source NAT to the correct IP address:
<div class="highlight"><pre><span></span><code>sh-5.2#<span class="w"> </span>iptables-save<span class="w"> </span>
<span class="c1"># Generated by iptables-save v1.8.7 on Tue Jul 25 13:09:39 2023</span>
*mangle
:PREROUTING<span class="w"> </span>ACCEPT<span class="w"> </span><span class="o">[</span><span class="m">14087</span>:9430205<span class="o">]</span>
:INPUT<span class="w"> </span>ACCEPT<span class="w"> </span><span class="o">[</span><span class="m">13923</span>:9397241<span class="o">]</span>
:FORWARD<span class="w"> </span>ACCEPT<span class="w"> </span><span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
:OUTPUT<span class="w"> </span>ACCEPT<span class="w"> </span><span class="o">[</span><span class="m">11270</span>:1030982<span class="o">]</span>
...
:KUBE-POSTROUTING<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
:OVN-KUBE-EGRESS-IP-Multi-NIC<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
:OVN-KUBE-EGRESS-SVC<span class="w"> </span>-<span class="w"> </span><span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
...
-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-j<span class="w"> </span>OVN-KUBE-EGRESS-IP-MULTI-NIC
-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-j<span class="w"> </span>OVN-KUBE-EGRESS-SVC
-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-o<span class="w"> </span>ovn-k8s-mp0<span class="w"> </span>-j<span class="w"> </span>OVN-KUBE-SNAT-MGMTPORT
-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-m<span class="w"> </span>comment<span class="w"> </span>--comment<span class="w"> </span><span class="s2">&quot;kubernetes postrouting rules&quot;</span><span class="w"> </span>-j<span class="w"> </span>KUBE-POSTROUTING
-A<span class="w"> </span>KUBE-MARK-DROP<span class="w"> </span>-j<span class="w"> </span>MARK<span class="w"> </span>--set-xmark<span class="w"> </span>0x8000/0x8000
-A<span class="w"> </span>KUBE-POSTROUTING<span class="w"> </span>-m<span class="w"> </span>comment<span class="w"> </span>--comment<span class="w"> </span><span class="s2">&quot;kubernetes service traffic requiring SNAT&quot;</span><span class="w"> </span>-j<span class="w"> </span>MASQUERADE<span class="w"> </span>--random-fully
...
-A<span class="w"> </span>OVN-KUBE-EGRESS-IP-MULTI-NIC<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.244.2.3/32<span class="w"> </span>-o<span class="w"> </span>dummy<span class="w"> </span>-j<span class="w"> </span>SNAT<span class="w"> </span>--to-source<span class="w"> </span><span class="m">10</span>.10.10.100
...
-A<span class="w"> </span>OVN-KUBE-EGRESS-SVC<span class="w"> </span>-m<span class="w"> </span>mark<span class="w"> </span>--mark<span class="w"> </span>0x3f0<span class="w"> </span>-m<span class="w"> </span>comment<span class="w"> </span>--comment<span class="w"> </span>DoNotSNAT<span class="w"> </span>-j<span class="w"> </span>RETURN
-A<span class="w"> </span>OVN-KUBE-SNAT-MGMTPORT<span class="w"> </span>-o<span class="w"> </span>ovn-k8s-mp0<span class="w"> </span>-m<span class="w"> </span>comment<span class="w"> </span>--comment<span class="w"> </span><span class="s2">&quot;OVN SNAT to Management Port&quot;</span><span class="w"> </span>-j<span class="w"> </span>SNAT<span class="w"> </span>--to-source<span class="w"> </span><span class="m">10</span>.244.2.2
COMMIT
...
</code></pre></div></p>
<p>IPRoute2 rules will look like the following - note rule with priority <code>6000</code> and also the table <code>1111</code>:
<div class="highlight"><pre><span></span><code>sh-5.2#<span class="w"> </span>ip<span class="w"> </span>rule
<span class="m">0</span>:<span class="w">  </span>from<span class="w"> </span>all<span class="w"> </span>lookup<span class="w"> </span><span class="nb">local</span>
<span class="m">30</span>:<span class="w"> </span>from<span class="w"> </span>all<span class="w"> </span>fwmark<span class="w"> </span>0x1745ec<span class="w"> </span>lookup<span class="w"> </span><span class="m">7</span>
<span class="m">6000</span>:<span class="w">   </span>from<span class="w"> </span><span class="m">10</span>.244.2.3<span class="w"> </span>lookup<span class="w"> </span><span class="m">1111</span>
<span class="m">32766</span>:<span class="w">  </span>from<span class="w"> </span>all<span class="w"> </span>lookup<span class="w"> </span>main
<span class="m">32767</span>:<span class="w">  </span>from<span class="w"> </span>all<span class="w"> </span>lookup<span class="w"> </span>default
</code></pre></div></p>
<p>And the default route in the correct table <code>1111</code>:
<div class="highlight"><pre><span></span><code>sh-5.2#<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>show<span class="w"> </span>table<span class="w"> </span><span class="m">1111</span>
default<span class="w"> </span>dev<span class="w"> </span>dummy
</code></pre></div></p>
<p>No NAT is required on the OVN primary network gateway router.
OVN-Kubernetes (ovnkube-node) takes care of adding a rule to the rule table with src IP of the pod and routed towards a
new routing table specifically created to route the traffic out the correct interface. IPTables rules are also altered and an entry
is created within the chain <code>OVN-KUBE-EGRESS-IP-Multi-NIC</code> for each selected pod to allow SNAT to occur when
egress-ing a particular interface. The routing table number <code>1111</code> is generated from the interface name.
Routes within the main routing table who's output interface share the same interface used for Egress IP are also cloned into the VRF 1111.</p>
<h3 id="pod-to-node-ip-traffic">Pod to node IP traffic<a class="headerlink" href="#pod-to-node-ip-traffic" title="Permanent link">&para;</a></h3>
<p>When a cluster networked pod matched by an egress IP tries to connect to a non-local node IP it hits the following
logical router policy in <code>ovn_cluster_router</code>:
<div class="highlight"><pre><span></span><code><span class="c1"># $&lt;all_eip_pod_ips&gt; - address-set of all pod IPs matched by any EgressIP</span>
<span class="c1"># $&lt;all_esvc_pod_ips&gt; - address-set of all pod IPs matched by any EgressService</span>
<span class="c1"># $&lt;all_node_ips&gt; - address-set of all node IPs in the cluster</span>
<span class="m">102</span><span class="w"> </span><span class="o">(</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span>$&lt;all_eip_pod_ips&gt;<span class="w"> </span><span class="o">||</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span>$&lt;all_esvc_pod_ips&gt;<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span>$&lt;all_node_ips&gt;<span class="w">  </span>allow<span class="w">    </span><span class="nv">pkt_mark</span><span class="o">=</span><span class="m">1008</span>
</code></pre></div>
In addition to simply allowing the <code>pod -&gt; node IP</code> traffic so that EgressIP reroute policies 
are not matched upon, it is also marked with the 1008 mark.<br />
If a pod is hosted on an egressNode the traffic will first get SNATed to the egress IP, and then it will hit 
following flow on breth0 that will SNAT the traffic to local node IP:
<div class="highlight"><pre><span></span><code><span class="c1"># output truncated, 0x3f0 == 1008</span>
<span class="nv">priority</span><span class="o">=</span><span class="m">105</span>,pkt_mark<span class="o">=</span>0x3f0,ip,in_port<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,zone<span class="o">=</span><span class="m">64000</span>,nat<span class="o">(</span><span class="nv">src</span><span class="o">=</span>&lt;NodeIP&gt;<span class="o">)</span>,exec<span class="o">(</span>load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[]))</span>,output:1
</code></pre></div>
This is required to make <code>pod -&gt; node IP</code> traffic behave the same regardless of where the pod is hosted.<br />
Implementation details: https://github.com/ovn-org/ovn-kubernetes/commit/e2c981a42a28e6213d9daf3b4489c18dc2b84b19.</p>
<p>For local gateway mode, in which an Egress IP is assigned to a non-primary interface, an IP rule is added to send packets
to the main routing table at a priority higher than that of EgressIP IP rules, which are set to priority <code>6000</code>:
<div class="highlight"><pre><span></span><code><span class="m">5999</span>:<span class="w">   </span>from<span class="w"> </span>all<span class="w"> </span>fwmark<span class="w"> </span>0x3f0<span class="w"> </span>lookup<span class="w"> </span>main
</code></pre></div>
Note: <code>0x3f0</code> is <code>1008</code> in hexadecimal. Lower IP rule priority number indicates higher precedence versus higher IP rule priority number.</p>
<p>This ensures all traffic to node IPs will not be selected by EgressIP IP rules.
However, reply traffic will not have the mark <code>1008</code> and would be dropped by reverse path filtering, therefore we add
an IPTable rule to the mangle table to save and restore the <code>1008</code> mark:
<div class="highlight"><pre><span></span><code>sh-5.2#<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>mangle<span class="w"> </span>-L<span class="w">  </span>PREROUTING
Chain<span class="w"> </span>PREROUTING<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination
CONNMARK<span class="w">   </span>all<span class="w">  </span>--<span class="w">  </span>anywhere<span class="w">             </span>anywhere<span class="w">             </span>mark<span class="w"> </span>match<span class="w"> </span>0x3f0<span class="w"> </span>CONNMARK<span class="w"> </span>save
CONNMARK<span class="w">   </span>all<span class="w">  </span>--<span class="w">  </span>anywhere<span class="w">             </span>anywhere<span class="w">             </span>mark<span class="w"> </span>match<span class="w"> </span>0x0<span class="w"> </span>CONNMARK<span class="w"> </span>restore
</code></pre></div></p>
<h3 id="dealing-with-non-snated-traffic">Dealing with non SNATed traffic<a class="headerlink" href="#dealing-with-non-snated-traffic" title="Permanent link">&para;</a></h3>
<p>Egress IP is often configured on a node different from the one hosting the affected pods.<br />
Due to the fact that ovn-controllers on different nodes apply the changes independently,
there is a chance that some pod traffic will reach the egress node before it configures the SNAT rules.
The following flows are added on breth0 to address this scenario:
<div class="highlight"><pre><span></span><code><span class="c1"># Commit connections from local pods so they are not affected by the drop rule below, this is required for ICNIv2</span>
<span class="nv">priority</span><span class="o">=</span><span class="m">109</span>,ip,in_port<span class="o">=</span><span class="m">2</span>,nw_src<span class="o">=</span>&lt;nodeSubnet&gt;<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,zone<span class="o">=</span><span class="m">64000</span>,exec<span class="o">(</span>set_field:0x1-&gt;ct_mark<span class="o">))</span>,output:1

<span class="c1"># Drop non SNATed egress traffic coming from non-local pods</span>
<span class="nv">priority</span><span class="o">=</span><span class="m">104</span>,ip,in_port<span class="o">=</span><span class="m">2</span>,nw_src<span class="o">=</span>&lt;clusterSubnet&gt;<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>drop

<span class="c1"># Commit connections coming from IPs not in cluster network</span>
<span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,in_port<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,zone<span class="o">=</span><span class="m">64000</span>,exec<span class="o">(</span>set_field:0x1-&gt;ct_mark<span class="o">))</span>,output:1
</code></pre></div></p>
<h2 id="special-considerations-for-egress-ips-hosted-by-standard-linux-interfaces">Special considerations for Egress IPs hosted by standard linux interfaces<a class="headerlink" href="#special-considerations-for-egress-ips-hosted-by-standard-linux-interfaces" title="Permanent link">&para;</a></h2>
<p>If you wish to assign an Egress IP to a standard linux interface (non OVS type), then the following is required:
* Link is up
* IP address must have scope universe / global
* Links and their addresses must not be removed during runtime after an egress IP is assigned to it. If you wish to remove the link, first
remove the Egress IP and then remove the address / link.
* IP forwarding must be enabled for the link</p>
<h2 id="egress-nodes">Egress Nodes<a class="headerlink" href="#egress-nodes" title="Permanent link">&para;</a></h2>
<p>In order to select which node(s) may be used as egress, the following label must be added to the <code>node</code> resource:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>&lt;node_name&gt;<span class="w"> </span>k8s.ovn.org/egress-assignable<span class="o">=</span><span class="s2">&quot;&quot;</span>
</code></pre></div>
<h2 id="egress-ip-reachability">Egress IP reachability<a class="headerlink" href="#egress-ip-reachability" title="Permanent link">&para;</a></h2>
<p>Once a node has been labeled with <code>k8s.ovn.org/egress-assignable</code>, the EgressIP operator in the leader ovnkube-master pod will periodically check if that node is
usable. EgressIPs assigned to a node that is no longer reachable will get revalidated and moved to another useable node.</p>
<p>Egress nodes normally have multiple IP addresses. For sake of Egress IP reachability, <a href="https://github.com/ovn-org/ovn-kubernetes/pull/2495">the management</a> (aka internal SDN) addresses of the node are the ones used. In deployments of ovn-kubernetes this is known to be the <code>ovn-k8s-mp0</code> interface of a node.</p>
<p>Even though the periodic checking of egress nodes is hard coded to trigger <a href="https://github.com/ovn-org/ovn-kubernetes/blob/82f167a3920c8c3cd0687ceb3e7a5ba64372be69/go-controller/pkg/ovn/egressip.go#L2206">every 5 seconds</a>, there are attributes that the user can set:</p>
<ul>
<li>egressIPTotalTimeout</li>
<li>gRPC vs. DISCARD port</li>
</ul>
<h3 id="egressiptotaltimeout">egressIPTotalTimeout<a class="headerlink" href="#egressiptotaltimeout" title="Permanent link">&para;</a></h3>
<p>This attribute specifies the maximum amount of time, in seconds, that the egressIP operator will wait until it declares the node unreachable. The default value is <a href="https://github.com/ovn-org/ovn-kubernetes/blob/82f167a3920c8c3cd0687ceb3e7a5ba64372be69/go-controller/pkg/config/config.go#L866">1 second</a>.</p>
<p>This value can be set in the following ways:
- ovnkube binary flag: <code>--egressip-reachability-total-timeout=&lt;TIMEOUT&gt;</code>
- inside config specified by <code>--config-file</code> flag:
<div class="highlight"><pre><span></span><code>[ovnkubernetesfeature]
egressip-reachability-total-timeout=123
</code></pre></div></p>
<p><strong>Note:</strong> Using value <code>0</code> will skip reachability. Use this to assume that egress nodes are available.</p>
<h3 id="grpc-vs-discard-port">gRPC vs. DISCARD port<a class="headerlink" href="#grpc-vs-discard-port" title="Permanent link">&para;</a></h3>
<p>Up until recently, the only method available for determining if an egress node was reachable relied on the <code>TCP port unreachable</code> icmp response from the probed node. The TCP port 9 (aka DISCARD) is the port used for that.</p>
<p><a href="https://github.com/ovn-org/ovn-kubernetes/pull/3100">Later implementation</a> of ovn-kubernetes is capable of leveraging secure gRPC sessions in order to probe nodes. That requires the <code>ovnkube node</code> pods to be listening on a pre-specified TCP port, in addition to configuring the <code>ovnkube master</code> pod(s).</p>
<p>This value can be set in the following ways:
- ovnkube binary flag: <code>--egressip-node-healthcheck-port=&lt;TCP_PORT&gt;</code>
- inside config specified by <code>--config-file</code> flag:
<div class="highlight"><pre><span></span><code>[ovnkubernetesfeature]
egressip-node-healthcheck-port=9107
</code></pre></div></p>
<p><strong>Note:</strong> If not specifying a value, or using <code>0</code> as the <code>egressip-node-healthcheck-port</code> will make Egress IP reachability probe the egress nodes using the DISCARD port method. Unlike egressip-reachability-total-timeout, it is important that both node and master pods of ovnkube get configured with the same value!</p>
<h4 id="additional-details-on-the-implementation-of-the-grpc-probing">Additional details on the implementation of the gRPC probing:<a class="headerlink" href="#additional-details-on-the-implementation-of-the-grpc-probing" title="Permanent link">&para;</a></h4>
<ul>
<li>If available, the session uses the <a href="https://github.com/ovn-org/ovn-kubernetes/blob/82f167a3920c8c3cd0687ceb3e7a5ba64372be69/go-controller/pkg/ovn/healthcheck/egressip_healthcheck.go#L78">same TLS certs</a> used by ovnkube to connect to the northbound OVSDB server. Conversely, an insecure gRPC session is used when no certs are specified.</li>
<li>The <a href="https://github.com/ovn-org/ovn-kubernetes/blob/82f167a3920c8c3cd0687ceb3e7a5ba64372be69/go-controller/pkg/ovn/healthcheck/health.proto#L6">message used for probing</a> is the <a href="https://github.com/grpc/grpc/blob/master/src/proto/grpc/health/v1/health.proto">standard service health</a> specified in gRPC.</li>
<li><a href="https://github.com/ovn-org/ovn-kubernetes/blob/82f167a3920c8c3cd0687ceb3e7a5ba64372be69/go-controller/pkg/ovn/healthcheck/egressip_healthcheck.go#L193-L195">Special care was taken into consideration</a> to handle cases when the gRPC session bounced for normal reasons. EgressIP implementation will not declare a node unreachable under these circumstances.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "content.code.annotate", "navigation.instant.preview"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>